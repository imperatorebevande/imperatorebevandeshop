import{j as t,t as se,l as ae,X as oe,G as ie,L as ne}from"./ui-vendor-BbdbCsUZ.js";import{r as m}from"./react-vendor-DTdTrAaS.js";import{H as D}from"./Header-C9jOduFB.js";import{P as le}from"./ProductCard-D9S1tC00.js";import{R as ce}from"./ReorderModal-CTPUJ40K.js";import{L as de}from"./LoadingAnimation-DSdHTKkN.js";import{B as v}from"./button-DV96QXU2.js";import{C as me,a as ue}from"./card-po8LLNoY.js";import{b as ge,u as I,c as xe}from"./useWooCommerce-BVF7l480.js";import{b as pe,c as he,u as be}from"./router-vendor-Dt4hhyuR.js";import{u as fe,a as ve,g as N}from"./index-CU51xw2J.js";import"./input-BScXBkmv.js";import"./badge-Dt5wVqj5.js";import"./dialog-rh9CTZ6-.js";import"./LottieAnimation-C9YeEbxN.js";import"./animation-vendor-C6M_rq1e.js";import"./query-vendor-CYSRxJYb.js";import"./chart-vendor-CC4yw7IZ.js";import"./utils-vendor-BbYF_8OW.js";const ze=()=>{var O,T,z;const{authState:l}=fe();ve();const[n,A]=m.useState("grid"),[a,j]=m.useState("all"),[u,w]=m.useState("all"),[d,P]=m.useState(""),L=m.useRef(null),[g,q]=pe(),{category:x,subcategory:p}=he(),h=be(),[W,E]=m.useState(!1),R=l!=null&&l.isAuthenticated&&((O=l==null?void 0:l.user)!=null&&O.id)?l.user.id:null,{data:G=[],isLoading:M}=ge(R,{per_page:1,orderby:"date",order:"desc"},{enabled:!!R}),b=G[0],H=()=>{E(!0)};m.useEffect(()=>{if(g.get("search")==="focus"&&L.current){L.current.focus();const o=new URLSearchParams(g);o.delete("search"),q(o,{replace:!0})}const e=g.get("search");e&&e!=="focus"&&P(e)},[g,q]);const[Q,V]=m.useState([]),{data:$=[],error:X,isLoading:J}=I({per_page:100,page:1}),{data:_=[],error:K,isLoading:Y}=I({per_page:100,page:2}),Z=X||K,k=J||Y;m.useEffect(()=>{const o=[...$,..._].filter((s,r,c)=>r===c.findIndex(f=>f.id===s.id));V(o)},[$,_]),xe({per_page:100,hide_empty:!0}),m.useEffect(()=>{if(x&&x!==a)j(x);else if(!x){const e=g.get("category");e&&e!==a?j(e):!e&&a!=="all"&&j("all")}if(p&&p!==u)w(p);else if(!p){const e=g.get("subcategory");e&&e!==u?w(e):!e&&u!=="all"&&w("all")}},[g,x,p,a,u]);const y=[{id:"all",name:"Tutti",bgColor:"bg-gradient-to-br from-gray-100 to-gray-200",textColor:"text-gray-800",icon:"🛒"},{id:"acqua",name:"Acqua",bgColor:"bg-gradient-to-br from-blue-100 to-blue-200",textColor:"text-blue-800",icon:"💧"},{id:"birra",name:"Birra",bgColor:"bg-gradient-to-br from-amber-100 to-amber-200",textColor:"text-amber-800",icon:"🍺"},{id:"vino",name:"Vino",bgColor:"bg-gradient-to-br from-purple-100 to-purple-200",textColor:"text-purple-800",icon:"🍷"},{id:"bevande",name:"Bevande",bgColor:"bg-gradient-to-br from-green-100 to-green-200",textColor:"text-green-800",icon:"🥤"}],ee=e=>{if(!e.categories||e.categories.length===0)return"altri";for(const o of e.categories){const s=o.slug.toLowerCase(),r=o.name.toLowerCase();if(s==="acqua"||s.includes("acqua")||r.includes("acqua")||r.includes("water"))return"acqua";if(s==="birra"||s.includes("birra")||r.includes("birra")||r.includes("beer"))return"birra";if(s==="vino"||s.includes("vino")||r.includes("vino")||r.includes("wine"))return"vino";if(s==="bevande"||s.includes("bevande")||r.includes("bevande")||r.includes("drink")||s==="cocacola"||s==="fanta"||s==="sanbenedetto"||s==="sanpellegrino"||s==="schweppes"||s.includes("altre-bevande")||r.includes("coca")||r.includes("fanta")||r.includes("san benedetto")||r.includes("san pellegrino")||r.includes("schweppes"))return"bevande"}return"altri"},te=e=>{var s;if(d&&a==="all"){const r={};return e.forEach(c=>{if(c.categories&&c.categories.length>0){const i=(c.categories.find(S=>S.parent===0)||c.categories[0]).name;r[i]||(r[i]=[]),r[i].push(c)}else r.Altri||(r.Altri=[]),r.Altri.push(c)}),r}if(a==="all"&&!d)return{"Tutti i prodotti":e};const o={};if(e.forEach(r=>{if(r.categories&&r.categories.length>0){const c=r.categories.filter(f=>{const i=f.slug.toLowerCase();return!!(a==="acqua"&&(i==="acqua"||i.includes("acqua-"))||a==="birra"&&(i==="birra"||i.includes("birra-"))||a==="vino"&&(i==="vino"||i.includes("vino-"))||a==="bevande"&&(i==="bevande"||i.includes("bevande-")||i==="cocacola"||i==="fanta"||i==="sanbenedetto"||i==="sanpellegrino"||i==="schweppes"||i.includes("altre-bevande")))});if(c.length>0){const i=(c.find(S=>S.parent!==0)||c[0]).name;o[i]||(o[i]=[]),o[i].push(r)}}}),Object.keys(o).length===0&&e.length>0){const r=((s=y.find(c=>c.id===a))==null?void 0:s.name)||"Prodotti";o[r]=e}return o},C=Q.filter(e=>e.stock_status==="instock").map(e=>{var s,r;const o=ee(e);return{id:e.id,name:e.name,price:parseFloat(e.price)||0,image:((r=(s=e.images)==null?void 0:s[0])==null?void 0:r.src)||"/placeholder.svg",description:(e.description||e.short_description||"").replace(/<[^>]*>/g,"").trim(),inStock:e.stock_status==="instock",category:o,categories:e.categories,slug:e.slug}}).filter(e=>{const o=a==="all"||e.category===a;let s=!0;u!=="all"&&e.categories&&(s=e.categories.some(c=>c.slug.toLowerCase().replace(/-/g,"-")===u.toLowerCase().replace(/-/g,"-")||c.name.toLowerCase().replace(/\s+/g,"-")===u.toLowerCase().replace(/-/g,"-")));const r=d===""||e.name.toLowerCase().includes(d.toLowerCase())||e.description.toLowerCase().includes(d.toLowerCase());return o&&s&&r}).sort((e,o)=>e.price-o.price),B=te(C),re=e=>{j(e),h(e==="all"?"/prodotti":`/prodotti/categoria/${e}`)};if(Z)return t.jsxs("div",{className:"min-h-screen bg-gray-50 pb-16 md:pb-0",children:[t.jsx(D,{}),t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx("div",{className:"text-center py-16",children:t.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-md mx-auto",children:[t.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),t.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:"Errore nel caricamento"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Non è stato possibile caricare i prodotti."}),t.jsx(v,{onClick:()=>window.location.reload(),className:"bg-purple-600 hover:bg-purple-700",children:"Riprova"})]})})})]});const F=()=>{P("")};return t.jsxs("div",{className:"min-h-screen bg-gray-50 pb-16 md:pb-0",children:[t.jsx(D,{}),(l==null?void 0:l.isAuthenticated)&&b&&t.jsx("div",{className:"sticky top-0 z-40 bg-white shadow-md border-b",children:t.jsx("div",{className:"container mx-auto px-4 py-3",children:t.jsx("div",{className:"w-full max-w-4xl mx-auto",children:t.jsxs(v,{onClick:H,className:"w-full text-white py-3 px-6 rounded-xl font-bold text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.01] active:scale-[0.99] border-0 relative overflow-hidden group",style:{backgroundColor:"#A11E26"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#8B1A21",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#A11E26",disabled:M,children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 translate-x-[-100%] group-hover:translate-x-[200%] transition-transform duration-1000 ease-out"}),t.jsx("div",{className:"relative flex items-center justify-center gap-3",children:M?"Caricamento...":t.jsxs(t.Fragment,{children:[t.jsx(se,{className:"w-5 h-5"}),t.jsxs("div",{className:"flex flex-col items-center sm:flex-row sm:gap-2",children:[t.jsx("span",{className:"font-bold",children:"Riordina Ultimo Acquisto"}),t.jsxs("span",{className:"text-sm font-normal opacity-90 hidden sm:inline",children:["• ",new Date(b.date_created).toLocaleDateString("it-IT")]})]})]})}),t.jsx("div",{className:"absolute bottom-1 right-3 text-xs opacity-75 sm:hidden",children:new Date(b.date_created).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit"})})]})})})}),t.jsxs("div",{className:`container mx-auto px-4 py-8 pb-20 md:pb-8 ${l!=null&&l.isAuthenticated&&b?"pt-4":""}`,children:[t.jsxs("section",{className:"mb-8",children:[t.jsx("div",{className:"text-center mb-6",children:t.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent",children:"Filtra per Categoria"})}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 max-w-4xl mx-auto",children:y.map(e=>t.jsx("button",{onClick:()=>re(e.id),className:`group transition-all duration-300 ${a===e.id?"scale-105 shadow-lg":"hover:scale-105 hover:shadow-lg"}`,children:t.jsx(me,{className:`${e.bgColor} border-0 overflow-hidden h-24 md:h-28 ${a===e.id?"ring-2 ring-blue-500 ring-offset-2":""}`,children:t.jsxs(ue,{className:"p-3 h-full flex flex-col justify-center items-center text-center",children:[t.jsx("div",{className:"text-2xl md:text-3xl mb-1",children:e.icon}),t.jsx("h3",{className:`text-sm md:text-base font-bold ${e.textColor}`,children:e.name})]})})},e.id))})]}),t.jsx("section",{className:"mb-8",children:t.jsx("div",{className:"max-w-md mx-auto",children:t.jsxs("div",{className:"relative",children:[t.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{ref:L,type:"text",placeholder:"Cerca prodotti...",value:d,onChange:e=>P(e.target.value),className:"w-full pl-10 pr-10 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),d&&t.jsx("button",{onClick:F,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t.jsx(oe,{className:"w-4 h-4"})})]})})}),a!=="all"&&t.jsx("div",{className:"mb-4",children:t.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t.jsx("button",{onClick:()=>h("/prodotti"),className:"hover:text-blue-600 transition-colors duration-200",children:"Tutti i Prodotti"}),t.jsx("span",{className:"text-gray-400",children:"/"}),t.jsx("button",{onClick:()=>h(`/prodotti/categoria/${a}`),className:"hover:text-blue-600 transition-colors duration-200 font-medium",style:{color:N(a)},children:(T=y.find(e=>e.id===a))==null?void 0:T.name}),u!=="all"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gray-400",children:"/"}),t.jsx("span",{className:"font-medium text-gray-800",children:u.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())})]})]})}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold",style:{color:a!=="all"?N(a):"#374151"},children:d?"Risultati ricerca":a==="all"?"Tutti i Prodotti":(z=y.find(e=>e.id===a))==null?void 0:z.name}),t.jsxs("p",{className:"text-gray-600 mt-1",children:[C.length," prodotti ",d||a!=="all"?"trovati":"disponibili"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{variant:n==="grid"?"default":"outline",size:"sm",onClick:()=>A("grid"),className:"p-2",children:t.jsx(ie,{className:"w-4 h-4"})}),t.jsx(v,{variant:n==="list"?"default":"outline",size:"sm",onClick:()=>A("list"),className:"p-2",children:t.jsx(ne,{className:"w-4 h-4"})})]})]}),k&&t.jsx("div",{className:"flex justify-center items-center py-16",children:t.jsx(de,{width:150,height:150,text:"Caricamento prodotti",className:"py-8"})}),!k&&C.length>0&&t.jsx("div",{className:"space-y-8",children:Object.entries(B).map(([e,o])=>t.jsxs("div",{className:"space-y-4",children:[Object.keys(B).length>1&&e!=="Tutti i prodotti"&&t.jsx("div",{className:"border-b border-gray-200 pb-2",children:t.jsx("button",{onClick:()=>{const s=je(e),r=e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");s&&s!=="all"&&h(`/prodotti/categoria/${s}/sottocategoria/${r}`)},className:"group hover:bg-gray-50 rounded-lg p-2 -m-2 transition-colors duration-200 w-full text-left",children:t.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2 group-hover:scale-[1.02] transition-transform duration-200",style:{color:a==="all"?U(e):N(a)},children:[t.jsx("span",{className:"w-1 h-6 rounded",style:{backgroundColor:a==="all"?U(e):N(a)}}),e,t.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",o.length," prodotti)"]}),t.jsx("span",{className:"text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200 ml-auto",children:"Clicca per vedere solo questa sottocategoria"})]})})}),t.jsx("div",{className:`grid gap-6 ${n==="grid"?"grid-cols-2 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-5":"grid-cols-1"}`,children:o.map(s=>t.jsx(le,{product:s},s.id))})]},e))}),!k&&C.length===0&&t.jsx("div",{className:"text-center py-16",children:t.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-md mx-auto",children:[t.jsx("div",{className:"text-6xl mb-4",children:d?"🔍":"📦"}),t.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:d?"Nessun risultato trovato":"Nessun prodotto trovato"}),t.jsx("p",{className:"text-gray-600 mb-4",children:d?`Non ci sono prodotti che corrispondono a "${d}".`:"Non ci sono prodotti disponibili al momento."}),d&&t.jsx(v,{onClick:F,variant:"outline",children:"Cancella ricerca"})]})})]}),t.jsx(ce,{isOpen:W,onClose:()=>E(!1),lastOrder:b})]})},je=l=>{const n=l.toLowerCase();return n.includes("acqua")?"acqua":n.includes("birra")?"birra":n.includes("bevande")||n.includes("coca")||n.includes("fanta")||n.includes("schweppes")||n.includes("san")?"bevande":n.includes("vino")?"vino":"all"},U=l=>{const n=l.toLowerCase();return n.includes("acqua")?"#1B5AAB":n.includes("birra")?"#CFA100":n.includes("bevande")||n.includes("coca")||n.includes("fanta")||n.includes("schweppes")?"#558E28":n.includes("vino")?"#8500AF":"#374151"};export{ze as default};
