import{j as e,ac as C,s as I,t as F,ad as T}from"./ui-vendor-CBu0MraC.js";import{H as z}from"./Header-Chz8Xda_.js";import{r as l}from"./react-vendor-DTdTrAaS.js";import{u as B,w as D,J as q}from"./index-I5fS8uHh.js";import{C as H,b as J,c as $,d as M,a as V}from"./card-CJGvcwoN.js";import{I as w,B as o}from"./input-BrCX-FV-.js";import{L as g}from"./label-BP42n_nh.js";import{A as E,a as R}from"./alert-cqSDNtBl.js";import{R as G}from"./Register-CRG7JJxq.js";import{c as K,d as O}from"./router-vendor-C3VyKldT.js";import"./chart-vendor-tNssjKKI.js";import"./query-vendor-CZPvIwdz.js";import"./utils-vendor-BbYF_8OW.js";const Q=({onSuccess:s,onSwitchToPhoneLogin:r,onSwitchToRegister:d})=>{const[a,m]=l.useState(""),[n,x]=l.useState(""),[y,u]=l.useState(!1),[h,t]=l.useState(""),[j,v]=l.useState(!1),[p,N]=l.useState(""),[A,f]=l.useState(!1),{login:L}=B(),b=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),S=async i=>{if(i.preventDefault(),t(""),u(!0),!a.trim()){t("Inserisci email"),u(!1);return}if(!b(a)){t("Inserisci un indirizzo email valido"),u(!1);return}if(!n.trim()){t("Inserisci la password"),u(!1);return}try{await L(a,n),s&&s()}catch(c){console.error("Errore durante il login:",c),t("Email o password non validi")}finally{u(!1)}},k=async i=>{if(i.preventDefault(),t(""),f(!0),!p.trim()){t("Inserisci email"),f(!1);return}if(!b(p)){t("Inserisci un indirizzo email valido"),f(!1);return}try{const c=await D.resetPassword(p);c.success?(q.success(c.message+" Controlla la tua casella di posta."),v(!1),N("")):t(c.message)}catch(c){console.error("Errore durante il reset password:",c),t("Errore nell'invio dell'email di recupero")}finally{f(!1)}},P=()=>{v(!1),N(""),t("")};return e.jsxs(H,{className:"w-full max-w-md mx-auto",children:[e.jsxs(J,{className:"space-y-1",children:[e.jsx($,{className:"text-2xl font-bold text-center text-[#1B5AAB]",children:j?"Recupera Password":"Accedi"}),e.jsx(M,{className:"text-center text-gray-600",children:j?"Inserisci la tua email per ricevere il link di recupero password":"Inserisci email e password per accedere"})]}),e.jsx(V,{children:j?e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"resetEmail",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(w,{id:"resetEmail",type:"email",placeholder:"Inserisci la tua email",value:p,onChange:i=>N(i.target.value),className:"pl-10",required:!0})]})]}),h&&e.jsx(E,{variant:"destructive",children:e.jsx(R,{children:h})}),e.jsx(o,{type:"submit",className:"w-full",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Invio in corso..."]}):"Invia Email di Recupero"}),e.jsx("div",{className:"text-center",children:e.jsxs(o,{type:"button",variant:"link",onClick:P,className:"text-sm flex items-center gap-1 mx-auto",children:[e.jsx(F,{className:"h-3 w-3"}),"Torna al Login"]})})]}):e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(w,{id:"email",type:"email",placeholder:"Inserisci la tua email",value:a,onChange:i=>m(i.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"password",children:"Password"}),e.jsx(o,{type:"button",variant:"link",onClick:()=>v(!0),className:"text-xs text-[#1B5AAB] hover:text-[#164a94] p-0 h-auto",children:"Password dimenticata?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx(w,{id:"password",type:"password",placeholder:"Inserisci la tua password",value:n,onChange:i=>x(i.target.value),className:"pl-10",required:!0})]})]}),h&&e.jsx(E,{variant:"destructive",children:e.jsx(R,{children:h})}),e.jsx(o,{type:"submit",className:"w-full",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Accesso in corso..."]}):"Accedi"}),r&&e.jsx("div",{className:"text-center",children:e.jsx(o,{type:"button",variant:"link",onClick:r,className:"text-sm",children:"Accesso rapido con telefono"})}),d&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Non hai ancora un account?"}),e.jsx(o,{type:"button",variant:"outline",onClick:d,className:"w-full border-[#1B5AAB] text-[#1B5AAB] hover:bg-[#1B5AAB] hover:text-white",children:"Crea un nuovo account"})]})]})})]})},U=({onSuccess:s,onClose:r})=>{const[d,a]=l.useState(!1),m=()=>{a(!0)},n=()=>{a(!1)},x=()=>{s?s():r&&r()};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:d?e.jsx(G,{onSuccess:x,onSwitchToLogin:n}):e.jsx(Q,{onSuccess:x,onSwitchToRegister:m})})},ce=()=>{var n;const{authState:s}=B(),r=K(),a=((n=O().state)==null?void 0:n.from)||"/account";l.useEffect(()=>{s!=null&&s.isAuthenticated&&r(a)},[s==null?void 0:s.isAuthenticated,r,a]);const m=()=>{r(a)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(z,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-8 text-[#1B5AAB]",children:"Accedi al tuo Account"}),e.jsx(U,{onClose:m})]})})]})};export{ce as default};
