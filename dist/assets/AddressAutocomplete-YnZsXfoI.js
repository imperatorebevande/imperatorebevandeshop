import{j as s,Q as U,M as B}from"./ui-vendor-BbdbCsUZ.js";import{r as o}from"./react-vendor-DTdTrAaS.js";import{I as V}from"./input-BScXBkmv.js";import{L as J}from"./label-CwSIXhkn.js";const M=()=>typeof window<"u"&&typeof window.google<"u"&&typeof window.google.maps<"u"&&typeof window.google.maps.places<"u",T=()=>new Promise((h,E)=>{if(M()){h();return}const g=setInterval(()=>{M()&&(clearInterval(g),h())},100);setTimeout(()=>{clearInterval(g),E(new Error("Google Maps API failed to load"))},1e4)}),ee=({label:h,placeholder:E,value:g,onChange:N,onAddressSelect:I,className:K="",required:$=!1,error:G=!1,focusTargetId:v})=>{const[n,p]=o.useState([]),[C,r]=o.useState(!1),[O,A]=o.useState(!1),[b,l]=o.useState(-1),[F,w]=o.useState(!1),P=o.useRef(null),k=o.useRef(null),D=o.useRef(null),H=async t=>{if(t.length<3){p([]),r(!1);return}A(!0);try{await T();const e=new window.google.maps.places.AutocompleteService,i={input:t,componentRestrictions:{country:"it"},types:["address"],bounds:new window.google.maps.LatLngBounds(new window.google.maps.LatLng(40.9,16.5),new window.google.maps.LatLng(41.3,17.1)),location:new window.google.maps.LatLng(41.1171,16.8719),radius:25e3};e.getPlacePredictions(i,(y,_)=>{if(A(!1),_===window.google.maps.places.PlacesServiceStatus.OK&&y){const L=["bari","ba","puglia","apulia","bitonto","molfetta","terlizzi","ruvo","corato","andria","trani","bisceglie","mola","polignano","monopoli","conversano","triggiano","capurso","cellamare","valenzano","modugno","bitetto","palo del colle","grumo","giovinazzo","altamura","gravina","santeramo","cassano","acquaviva","casamassima","sammichele","turi","putignano","noci","gioia del colle","adelfia","noicattaro"],c=y.filter(d=>{const u=d.description.toLowerCase();return L.some(m=>u.includes(m))}).sort((d,u)=>{const m=d.description.toLowerCase(),j=u.description.toLowerCase(),z=m.includes("bari"),x=j.includes("bari");return z&&!x?-1:!z&&x?1:0});p(c.slice(0,8)),r(!0),l(-1)}else p([]),r(!1)})}catch(e){console.error("Errore nel caricamento di Google Maps:",e),A(!1),p([]),r(!1)}},q=t=>{const e=t.target.value;N(e),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{F||H(e)},300)},R=async t=>{if(w(!0),r(!1),p([]),l(-1),I)try{await T(),new window.google.maps.places.PlacesService(document.createElement("div")).getDetails({placeId:t.place_id,fields:["address_components","formatted_address","geometry"]},(i,y)=>{var _,L;if(y===window.google.maps.places.PlacesServiceStatus.OK&&i){let S="",c="",d="",u="",m="",j;(_=i.geometry)!=null&&_.location&&(j={lat:i.geometry.location.lat(),lng:i.geometry.location.lng()}),(L=i.address_components)==null||L.forEach(a=>{const f=a.types;f.includes("street_number")?S=a.long_name:f.includes("route")?c=a.long_name:f.includes("locality")||f.includes("administrative_area_level_3")?d=a.long_name:f.includes("administrative_area_level_2")?u=a.short_name:f.includes("postal_code")&&(m=a.long_name)});const x=S&&c?`${c} ${S}`:c||t.structured_formatting.main_text;N(x),I&&I({address:x,city:d,province:u,postalCode:m,coordinates:j}),v&&setTimeout(()=>{const a=document.getElementById(v);a&&a.focus()},100),setTimeout(()=>{w(!1)},1e3)}else setTimeout(()=>{w(!1)},300)})}catch(e){console.error("Errore nel recupero dettagli indirizzo:",e),setTimeout(()=>{w(!1)},300)}else N(t.structured_formatting.main_text),v&&setTimeout(()=>{const e=document.getElementById(v);e&&e.focus()},100),setTimeout(()=>{w(!1)},300)};o.useEffect(()=>{const t=e=>{P.current&&!P.current.contains(e.target)&&k.current&&!k.current.contains(e.target)&&(r(!1),l(-1))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const Q=t=>{if(!(!C||n.length===0))switch(t.key){case"ArrowDown":t.preventDefault(),l(e=>e<n.length-1?e+1:e);break;case"ArrowUp":t.preventDefault(),l(e=>e>0?e-1:-1);break;case"Enter":t.preventDefault(),b>=0&&b<n.length&&R(n[b]);break;case"Escape":r(!1),l(-1);break}};return s.jsxs("div",{className:"relative",children:[s.jsxs(J,{className:"text-xs sm:text-sm font-semibold text-[#1B5AAB] mb-1 block",children:[h," ",$&&"*"]}),s.jsxs("div",{className:"relative",children:[s.jsx(V,{ref:P,value:g,onChange:q,onKeyDown:Q,onFocus:()=>{g.length>=3&&n.length>0&&r(!0)},placeholder:E,className:`pr-10 ${G?"border-red-500":""} ${K}`,autoComplete:"off"}),s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:O?s.jsx(U,{className:"h-4 w-4 animate-spin text-gray-400"}):s.jsx(B,{className:"h-4 w-4 text-gray-400"})}),C&&n.length>0&&s.jsx("div",{ref:k,className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-auto",children:n.map((t,e)=>s.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-50 border-b border-gray-100 last:border-b-0 ${e===b?"bg-blue-50":""}`,onClick:()=>R(t),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(B,{className:"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.structured_formatting.main_text}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.structured_formatting.secondary_text})]})]})},t.place_id))})]})]})};export{ee as A,T as w};
