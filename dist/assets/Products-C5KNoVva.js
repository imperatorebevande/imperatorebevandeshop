import{j as e,p as K,l as Y,X as Z,G as ee,L as re,s as te}from"./ui-vendor-CBu0MraC.js";import{r as u}from"./react-vendor-DTdTrAaS.js";import{H as D}from"./Header-Chz8Xda_.js";import{P as ae}from"./ProductCard-McAvPI1V.js";import{B as h}from"./input-BrCX-FV-.js";import{C as se,a as oe}from"./card-CJGvcwoN.js";import{b as ie,u as F,c as ne}from"./useWooCommerce-izqWt-aK.js";import{u as le}from"./router-vendor-C3VyKldT.js";import{u as ce,a as de,g as P,J as L,w as me}from"./index-I5fS8uHh.js";import"./query-vendor-CZPvIwdz.js";import"./chart-vendor-tNssjKKI.js";import"./utils-vendor-BbYF_8OW.js";const Le=()=>{var O,R;const{authState:n}=ce(),{dispatch:g}=de(),[f,E]=u.useState("grid"),[o,k]=u.useState("all"),[l,j]=u.useState(""),y=u.useRef(null),[p,b]=le(),_=n!=null&&n.isAuthenticated&&((O=n==null?void 0:n.user)!=null&&O.id)?n.user.id:null,{data:T=[],isLoading:ge}=ie(_,{per_page:1,orderby:"date",order:"desc"},{enabled:!!_}),x=T[0],M=async()=>{if(!x||!x.line_items){L.error("Nessun ordine precedente trovato");return}let r=0;try{const t=x.line_items.map(async a=>{var i,m,s;try{const c=await me.getProduct(a.product_id);console.log("=== DEBUG RIORDINO ==="),console.log("Prodotto completo:",JSON.stringify(c,null,2)),console.log("Categories array:",c.categories),console.log("Prima categoria:",(i=c.categories)==null?void 0:i[0]),console.log("Slug prima categoria:",(s=(m=c.categories)==null?void 0:m[0])==null?void 0:s.slug);const w=q(c);return console.log("Categoria determinata:",w),console.log("=== FINE DEBUG ==="),{cartItem:{id:a.product_id,name:a.name,price:parseFloat(a.price),image:c.images&&c.images.length>0?c.images[0].src:"/placeholder.svg",category:w},quantity:a.quantity}}catch(c){return console.error(`Errore nel recupero del prodotto ${a.product_id}:`,c),{cartItem:{id:a.product_id,name:a.name,price:parseFloat(a.price),image:"/placeholder.svg",category:"altri"},quantity:a.quantity}}});(await Promise.all(t)).forEach(({cartItem:a,quantity:i})=>{for(let m=0;m<i;m++)g({type:"ADD_ITEM",payload:a});r+=i}),L.success(`${r} prodotti dall'ultimo ordine aggiunti al carrello!`)}catch(t){console.error("Errore nel recupero dei prodotti:",t),L.error("Errore nel recupero delle informazioni dei prodotti")}};u.useEffect(()=>{if(p.get("search")==="focus"&&y.current){y.current.focus();const t=new URLSearchParams(p);t.delete("search"),b(t,{replace:!0})}const r=p.get("search");r&&r!=="focus"&&j(r)},[p,b]);const[z,G]=u.useState([]),{data:S=[],error:U,isLoading:J}=F({per_page:100,page:1,status:"publish"}),{data:A=[],error:W,isLoading:H}=F({per_page:100,page:2,status:"publish"}),Q=U||W,N=J||H;u.useEffect(()=>{const t=[...S,...A].filter((d,a,i)=>a===i.findIndex(m=>m.id===d.id));G(t)},[S,A]),ne({per_page:100,hide_empty:!0}),u.useEffect(()=>{const r=p.get("category");r&&k(r)},[p]);const C=[{id:"all",name:"Tutti",bgColor:"bg-gradient-to-br from-gray-100 to-gray-200",textColor:"text-gray-800",icon:"🛒"},{id:"acqua",name:"Acqua",bgColor:"bg-gradient-to-br from-blue-100 to-blue-200",textColor:"text-blue-800",icon:"💧"},{id:"birra",name:"Birra",bgColor:"bg-gradient-to-br from-amber-100 to-amber-200",textColor:"text-amber-800",icon:"🍺"},{id:"vino",name:"Vino",bgColor:"bg-gradient-to-br from-purple-100 to-purple-200",textColor:"text-purple-800",icon:"🍷"},{id:"bevande",name:"Bevande",bgColor:"bg-gradient-to-br from-green-100 to-green-200",textColor:"text-green-800",icon:"🥤"}],q=r=>{if(!r.categories||r.categories.length===0)return"altri";const t=r.categories[0].slug.toLowerCase();return t==="acqua"||t.includes("acqua-")?"acqua":t==="birra"||t.includes("birra-")?"birra":t==="vino"||t.includes("vino-")?"vino":t==="bevande"||t.includes("bevande-")||t==="cocacola"||t==="fanta"||t==="sanbenedetto"||t==="sanpellegrino"||t==="schweppes"||t.includes("altre-bevande")?"bevande":"altri"},V=r=>{var d;if(l&&o==="all"){const a={};return r.forEach(i=>{if(i.categories&&i.categories.length>0){const s=(i.categories.find(c=>c.parent===0)||i.categories[0]).name;a[s]||(a[s]=[]),a[s].push(i)}else a.Altri||(a.Altri=[]),a.Altri.push(i)}),a}if(o==="all"&&!l)return{"Tutti i prodotti":r};const t={};if(r.forEach(a=>{if(a.categories&&a.categories.length>0){const i=a.categories.filter(m=>{const s=m.slug.toLowerCase();return!!(o==="acqua"&&(s==="acqua"||s.includes("acqua-"))||o==="birra"&&(s==="birra"||s.includes("birra-"))||o==="vino"&&(s==="vino"||s.includes("vino-"))||o==="bevande"&&(s==="bevande"||s.includes("bevande-")||s==="cocacola"||s==="fanta"||s==="sanbenedetto"||s==="sanpellegrino"||s==="schweppes"||s.includes("altre-bevande")))});if(i.length>0){const s=(i.find(c=>c.parent!==0)||i[0]).name;t[s]||(t[s]=[]),t[s].push(a)}}}),Object.keys(t).length===0&&r.length>0){const a=((d=C.find(i=>i.id===o))==null?void 0:d.name)||"Prodotti";t[a]=r}return t},v=z.filter(r=>r.stock_status==="instock").map(r=>{var d,a;const t=q(r);return{id:r.id,name:r.name,price:parseFloat(r.price)||0,image:((a=(d=r.images)==null?void 0:d[0])==null?void 0:a.src)||"/placeholder.svg",description:(r.description||r.short_description||"").replace(/<[^>]*>/g,"").trim(),inStock:r.stock_status==="instock",category:t,categories:r.categories}}).filter(r=>{const t=o==="all"||r.category===o,d=l===""||r.name.toLowerCase().includes(l.toLowerCase())||r.description.toLowerCase().includes(l.toLowerCase());return t&&d}).sort((r,t)=>r.price-t.price),I=V(v),X=r=>{k(r),b(r==="all"?{}:{category:r})};if(Q)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(D,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-md mx-auto",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:"Errore nel caricamento"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Non è stato possibile caricare i prodotti."}),e.jsx(h,{onClick:()=>window.location.reload(),className:"bg-purple-600 hover:bg-purple-700",children:"Riprova"})]})})})]});const B=()=>{j("")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(D,{}),(n==null?void 0:n.isAuthenticated)&&x&&e.jsx("div",{className:"sticky top-0 z-40 bg-white shadow-md border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-3",children:e.jsx("div",{className:"w-full max-w-4xl mx-auto",children:e.jsxs(h,{onClick:M,className:"w-full bg-gradient-to-r from-emerald-500 via-green-500 to-teal-500 hover:from-emerald-600 hover:via-green-600 hover:to-teal-600 text-white py-3 px-6 rounded-xl font-bold text-base shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.01] active:scale-[0.99] border-0 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 translate-x-[-100%] group-hover:translate-x-[200%] transition-transform duration-1000 ease-out"}),e.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex flex-col items-center sm:flex-row sm:gap-2",children:[e.jsx("span",{className:"font-bold",children:"Riordina Ultimo Acquisto"}),e.jsxs("span",{className:"text-sm font-normal opacity-90 hidden sm:inline",children:["• ",new Date(x.date_created).toLocaleDateString("it-IT")]})]})]}),e.jsx("div",{className:"absolute bottom-1 right-3 text-xs opacity-75 sm:hidden",children:new Date(x.date_created).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit"})})]})})})}),e.jsxs("div",{className:`container mx-auto px-4 py-8 pb-20 md:pb-8 ${n!=null&&n.isAuthenticated&&x?"pt-4":""}`,children:[e.jsxs("section",{className:"mb-8",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent",children:"Filtra per Categoria"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 max-w-4xl mx-auto",children:C.map(r=>e.jsx("button",{onClick:()=>X(r.id),className:`group transition-all duration-300 ${o===r.id?"scale-105 shadow-lg":"hover:scale-105 hover:shadow-lg"}`,children:e.jsx(se,{className:`${r.bgColor} border-0 overflow-hidden h-24 md:h-28 ${o===r.id?"ring-2 ring-blue-500 ring-offset-2":""}`,children:e.jsxs(oe,{className:"p-3 h-full flex flex-col justify-center items-center text-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl mb-1",children:r.icon}),e.jsx("h3",{className:`text-sm md:text-base font-bold ${r.textColor}`,children:r.name})]})})},r.id))})]}),e.jsx("section",{className:"mb-8",children:e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{ref:y,type:"text",placeholder:"Cerca prodotti...",value:l,onChange:r=>j(r.target.value),className:"w-full pl-10 pr-10 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),l&&e.jsx("button",{onClick:B,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",style:{color:o!=="all"?P(o):"#374151"},children:l?"Risultati ricerca":o==="all"?"Tutti i Prodotti":(R=C.find(r=>r.id===o))==null?void 0:R.name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[v.length," prodotti ",l||o!=="all"?"trovati":"disponibili"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:f==="grid"?"default":"outline",size:"sm",onClick:()=>E("grid"),className:"p-2",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(h,{variant:f==="list"?"default":"outline",size:"sm",onClick:()=>E("list"),className:"p-2",children:e.jsx(re,{className:"w-4 h-4"})})]})]}),N&&e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(te,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-purple-600"}),e.jsx("p",{className:"text-gray-600",children:"Caricamento prodotti..."})]})}),!N&&v.length>0&&e.jsx("div",{className:"space-y-8",children:Object.entries(I).map(([r,t])=>e.jsxs("div",{className:"space-y-4",children:[Object.keys(I).length>1&&r!=="Tutti i prodotti"&&e.jsx("div",{className:"border-b border-gray-200 pb-2",children:e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",style:{color:o==="all"?$(r):P(o)},children:[e.jsx("span",{className:"w-1 h-6 rounded",style:{backgroundColor:o==="all"?$(r):P(o)}}),r,e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",t.length," prodotti)"]})]})}),e.jsx("div",{className:`grid gap-6 ${f==="grid"?"grid-cols-2 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-5":"grid-cols-1"}`,children:t.map(d=>e.jsx(ae,{product:d,viewMode:f},d.id))})]},r))}),!N&&v.length===0&&e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-md mx-auto",children:[e.jsx("div",{className:"text-6xl mb-4",children:l?"🔍":"📦"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-800",children:l?"Nessun risultato trovato":"Nessun prodotto trovato"}),e.jsx("p",{className:"text-gray-600 mb-4",children:l?`Non ci sono prodotti che corrispondono a "${l}".`:"Non ci sono prodotti disponibili al momento."}),l&&e.jsx(h,{onClick:B,variant:"outline",children:"Cancella ricerca"})]})})]})]})},$=n=>{const g=n.toLowerCase();return g.includes("acqua")?"#1B5AAB":g.includes("birra")?"#CFA100":g.includes("bevande")||g.includes("coca")||g.includes("fanta")||g.includes("schweppes")?"#558E28":g.includes("vino")?"#8500AF":"#374151"};export{Le as default};
