import{j as e,a5 as v,aj as z,al as _,ab as y,a9 as g,Q as R,z as B}from"./ui-vendor-BbdbCsUZ.js";import{r as m}from"./react-vendor-DTdTrAaS.js";import{u as q,w as C,J as d}from"./index-CU51xw2J.js";import{C as M,b as k,c as O,d as D,a as H}from"./card-po8LLNoY.js";import{B as w}from"./button-DV96QXU2.js";import{I as o}from"./input-BScXBkmv.js";import{L as c}from"./label-CwSIXhkn.js";import{A as J,a as U}from"./alert-BbkdLCMH.js";import{A as Q}from"./AddressAutocomplete-YnZsXfoI.js";const S=({onSuccess:p,onSwitchToLogin:n})=>{const[s,u]=m.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phone:"",address:"",city:"",postalCode:"",province:""}),[N,j]=m.useState(!1),[h,r]=m.useState(""),[x,b]=m.useState(!1),[f,A]=m.useState(!1),{setUser:P}=q(),l=t=>{const{name:i,value:a}=t.target;u(E=>({...E,[i]:a})),h&&r("")},F=()=>s.firstName.trim()?s.lastName.trim()?s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)?s.password?s.password.length<6?(r("La password deve essere di almeno 6 caratteri"),!1):s.password!==s.confirmPassword?(r("Le password non coincidono"),!1):!0:(r("La password è obbligatoria"),!1):(r("Inserisci un indirizzo email valido"),!1):(r("L'email è obbligatoria"),!1):(r("Il cognome è obbligatorio"),!1):(r("Il nome è obbligatorio"),!1),I=async t=>{if(t.preventDefault(),!!F()){j(!0),r("");try{const i=await C.createCustomer({email:s.email,first_name:s.firstName,last_name:s.lastName,password:s.password,billing:{first_name:s.firstName,last_name:s.lastName,email:s.email,phone:s.phone,address_1:s.address,city:s.city,postcode:s.postalCode,state:s.province,country:"IT"},shipping:{first_name:s.firstName,last_name:s.lastName,address_1:s.address,city:s.city,postcode:s.postalCode,state:s.province,country:"IT"}});d.success("Account creato con successo!");try{const a=await C.loginWithCredential(s.email,"email");a.success&&a.customer?(P({id:a.customer.id,email:a.customer.email,firstName:a.customer.first_name,lastName:a.customer.last_name,username:a.customer.username,billing:a.customer.billing,shipping:a.customer.shipping}),d.success("Accesso effettuato automaticamente!"),p==null||p()):(d.success("Account creato! Ora puoi effettuare l'accesso."),n==null||n())}catch(a){console.error("Errore nel login automatico:",a),d.success("Account creato! Ora puoi effettuare l'accesso."),n==null||n()}}catch(i){console.error("Errore nella registrazione:",i),r(i.message||"Errore durante la registrazione. Riprova."),d.error("Errore durante la registrazione")}finally{j(!1)}}};return e.jsxs(M,{className:"w-full max-w-md mx-auto",children:[e.jsxs(k,{className:"space-y-1",children:[e.jsx(O,{className:"text-2xl font-bold text-center text-[#1B5AAB]",children:"Crea Account"}),e.jsx(D,{className:"text-center",children:"Registrati per iniziare a fare acquisti"})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"firstName",children:"Nome *"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"firstName",name:"firstName",type:"text",placeholder:"Mario",value:s.firstName,onChange:l,className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"lastName",children:"Cognome *"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"lastName",name:"lastName",type:"text",placeholder:"Rossi",value:s.lastName,onChange:l,className:"pl-10",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email *"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"email",name:"email",type:"email",placeholder:"mario.rossi@email.com",value:s.email,onChange:l,className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Telefono"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"phone",name:"phone",type:"tel",placeholder:"123 456 7890",value:s.phone,onChange:l,className:"pl-10"})]})]}),e.jsx(Q,{label:"Indirizzo",placeholder:"Via Roma 123",value:s.address,onChange:t=>u(i=>({...i,address:t})),onAddressSelect:t=>{u(i=>({...i,address:t.address,city:t.city,province:t.province,postalCode:t.postalCode}))},focusTargetId:"city"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"city",children:"Città"}),e.jsx(o,{id:"city",name:"city",type:"text",placeholder:"Milano",value:s.city,onChange:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"postalCode",children:"CAP"}),e.jsx(o,{id:"postalCode",name:"postalCode",type:"text",placeholder:"20100",value:s.postalCode,onChange:l})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"province",children:"Provincia"}),e.jsx(o,{id:"province",name:"province",type:"text",placeholder:"MI",value:s.province,onChange:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"password",name:"password",type:x?"text":"password",placeholder:"Almeno 6 caratteri",value:s.password,onChange:l,className:"pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>b(!x),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:x?e.jsx(y,{className:"h-4 w-4"}):e.jsx(g,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"confirmPassword",children:"Conferma Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"confirmPassword",name:"confirmPassword",type:f?"text":"password",placeholder:"Ripeti la password",value:s.confirmPassword,onChange:l,className:"pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>A(!f),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:f?e.jsx(y,{className:"h-4 w-4"}):e.jsx(g,{className:"h-4 w-4"})})]})]}),h&&e.jsx(J,{variant:"destructive",children:e.jsx(U,{children:h})}),e.jsx(w,{type:"submit",className:"w-full bg-[#1B5AAB] hover:bg-[#164A9A]",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Creazione account..."]}):"Crea Account"}),n&&e.jsx("div",{className:"text-center",children:e.jsxs(w,{type:"button",variant:"ghost",onClick:n,className:"text-[#1B5AAB] hover:text-[#164A9A]",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Hai già un account? Accedi"]})})]})})]})};export{S as R};
