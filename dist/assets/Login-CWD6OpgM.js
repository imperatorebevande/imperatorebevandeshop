import{j as e,aj as C,Q as I,z,ak as F}from"./ui-vendor-BbdbCsUZ.js";import{H as T}from"./Header-C9jOduFB.js";import{r as l}from"./react-vendor-DTdTrAaS.js";import{u as B,w as U,J as D}from"./index-CU51xw2J.js";import{C as O,b as q,c as H,d as J,a as $}from"./card-po8LLNoY.js";import{B as o}from"./button-DV96QXU2.js";import{I as N}from"./input-BScXBkmv.js";import{L as g}from"./label-CwSIXhkn.js";import{A as E,a as R}from"./alert-BbkdLCMH.js";import{R as M}from"./Register-BJ4Ie7NL.js";import{u as Q,d as V}from"./router-vendor-Dt4hhyuR.js";import"./badge-Dt5wVqj5.js";import"./chart-vendor-CC4yw7IZ.js";import"./query-vendor-CYSRxJYb.js";import"./utils-vendor-BbYF_8OW.js";import"./AddressAutocomplete-YnZsXfoI.js";const G=({onSuccess:s,onSwitchToPhoneLogin:i,onSwitchToRegister:m})=>{const[a,d]=l.useState(""),[n,x]=l.useState(""),[y,u]=l.useState(!1),[p,t]=l.useState(""),[j,v]=l.useState(!1),[h,w]=l.useState(""),[b,f]=l.useState(!1),{login:L}=B(),A=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),S=async r=>{if(r.preventDefault(),t(""),u(!0),!a.trim()){t("Inserisci email/username"),u(!1);return}if(a.includes("@")&&!A(a)){t("Inserisci un indirizzo email valido"),u(!1);return}if(!n.trim()){t("Inserisci la password"),u(!1);return}try{await L(a,n),s&&s()}catch(c){console.error("Errore durante il login:",c),t("Email/username o password non validi")}finally{u(!1)}},k=async r=>{if(r.preventDefault(),t(""),f(!0),!h.trim()){t("Inserisci email"),f(!1);return}if(!A(h)){t("Inserisci un indirizzo email valido"),f(!1);return}try{const c=await U.resetPassword(h);c.success?(D.success(c.message+" Controlla la tua casella di posta."),v(!1),w("")):t(c.message)}catch(c){console.error("Errore durante il reset password:",c),t("Errore durante il reset della password")}finally{f(!1)}},P=()=>{v(!1),w(""),t("")};return e.jsxs(O,{className:"w-full max-w-md mx-auto",children:[e.jsxs(q,{className:"space-y-1",children:[e.jsx(H,{className:"text-2xl font-bold text-center text-[#1B5AAB]",children:j?"Recupera Password":"Accedi"}),e.jsx(J,{className:"text-center text-gray-600",children:j?"Inserisci la tua email per ricevere il link di recupero password":"Inserisci email e password per accedere"})]}),e.jsx($,{children:j?e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"resetEmail",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(N,{id:"resetEmail",type:"email",placeholder:"Inserisci la tua email",value:h,onChange:r=>w(r.target.value),className:"pl-10",required:!0})]})]}),p&&e.jsx(E,{variant:"destructive",children:e.jsx(R,{children:p})}),e.jsx(o,{type:"submit",className:"w-full",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Invio in corso..."]}):"Invia Email di Recupero"}),e.jsx("div",{className:"text-center",children:e.jsxs(o,{type:"button",variant:"link",onClick:P,className:"text-sm flex items-center gap-1 mx-auto",children:[e.jsx(z,{className:"h-3 w-3"}),"Torna al Login"]})})]}):e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"emailOrUsername",children:"Email o Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(N,{id:"emailOrUsername",type:"text",placeholder:"Inserisci email o username",value:a,onChange:r=>d(r.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"password",children:"Password"}),e.jsx(o,{type:"button",variant:"link",onClick:()=>v(!0),className:"text-xs text-[#1B5AAB] hover:text-[#164a94] p-0 h-auto",children:"Password dimenticata?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(N,{id:"password",type:"password",placeholder:"Inserisci la tua password",value:n,onChange:r=>x(r.target.value),className:"pl-10",required:!0})]})]}),p&&e.jsx(E,{variant:"destructive",children:e.jsx(R,{children:p})}),e.jsx(o,{type:"submit",className:"w-full",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Accesso in corso..."]}):"Accedi"}),i&&e.jsx("div",{className:"text-center",children:e.jsx(o,{type:"button",variant:"link",onClick:i,className:"text-sm",children:"Accesso rapido con telefono"})}),m&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Non hai ancora un account?"}),e.jsx(o,{type:"button",variant:"outline",onClick:m,className:"w-full border-[#1B5AAB] text-[#1B5AAB] hover:bg-[#1B5AAB] hover:text-white",children:"Crea un nuovo account"})]})]})})]})},K=({onSuccess:s,onClose:i})=>{const[m,a]=l.useState(!1),d=()=>{a(!0)},n=()=>{a(!1)},x=()=>{s?s():i&&i()};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:m?e.jsx(M,{onSuccess:x,onSwitchToLogin:n}):e.jsx(G,{onSuccess:x,onSwitchToRegister:d})})},de=()=>{var n;const{authState:s}=B(),i=Q(),a=((n=V().state)==null?void 0:n.from)||"/account";l.useEffect(()=>{s!=null&&s.isAuthenticated&&i(a)},[s==null?void 0:s.isAuthenticated,i,a]);const d=()=>{i(a)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-16 md:pb-0",children:[e.jsx(T,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-center mb-8 text-[#1B5AAB]",children:"Accedi al tuo Account"}),e.jsx(K,{onClose:d})]})})]})};export{de as default};
