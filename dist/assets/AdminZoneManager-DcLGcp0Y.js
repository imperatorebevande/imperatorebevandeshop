import{j as e,ab as Y,a9 as z,p as b,$ as ee,O as se,n as ie,av as L,aw as ae,ax as te}from"./ui-vendor-BbdbCsUZ.js";import{r as c}from"./react-vendor-DTdTrAaS.js";import{C as v,b as y,c as N,d as T,a as C}from"./card-po8LLNoY.js";import{B as d}from"./button-DV96QXU2.js";import{I as Z}from"./input-BScXBkmv.js";import{L as u}from"./label-CwSIXhkn.js";import{T as ne}from"./textarea-DYIflGP3.js";import{T as oe,a as le,b as E,c as A}from"./index-CceCJFVk.js";import{A as O,a as B}from"./alert-BbkdLCMH.js";import{L as re,C as ce}from"./LeafletMap-Brnjz1hq.js";import{getAllZones as de,saveZonesToFile as k}from"./deliveryZones-Dl4LSmEF.js";import"./index-CU51xw2J.js";import"./chart-vendor-CC4yw7IZ.js";import"./query-vendor-CYSRxJYb.js";import"./router-vendor-Dt4hhyuR.js";import"./utils-vendor-BbYF_8OW.js";const me="ImperatoreBev26",pe=["07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","10:00 - 11:00","11:00 - 12:00","12:00 - 13:00","13:00 - 14:00","14:00 - 15:00","15:00 - 16:00"],Ae=()=>{var I;const[j,P]=c.useState({isAuthenticated:!1,password:""}),[S,U]=c.useState(!1),[r,f]=c.useState([]),[o,m]=c.useState(null),[h,R]=c.useState(null);c.useState(!1),c.useState("");const[$,D]=c.useState(!1),[q,x]=c.useState(!1),[J,w]=c.useState("map");c.useEffect(()=>{const a=de().map(i=>({id:i.id,name:i.name,description:i.description||"",cities:i.cities,provinces:i.provinces,postalCodes:i.postalCodes,color:i.color||"#3B82F6",polygon:i.polygon?{coordinates:i.polygon.coordinates,center:i.polygon.center}:void 0,timeSlotRestrictions:i.timeSlotRestrictions}));f(a)},[]);const G=s=>{const a={lat:s.reduce((l,p)=>l+p[0],0)/s.length,lng:s.reduce((l,p)=>l+p[1],0)/s.length},i=s.map(l=>[l[1],l[0]]);if(i.length>0){const l=i[0],p=i[i.length-1];(l[0]!==p[0]||l[1]!==p[1])&&i.push([...l])}const t={id:`zona-${Date.now()}`,name:`Zona Poligono ${r.length+1}`,description:"Servizio consegne attivo con fasce orarie disponibili",cities:[],provinces:["BA"],postalCodes:[],color:"#3B82F6",polygon:{coordinates:[i],center:a},timeSlotRestrictions:{preferredSlots:["09:00-12:00","15:00-18:00"]}};f(l=>[...l,t]),m(t)},_=s=>{confirm("Sei sicuro di voler eliminare questa zona?")&&(f(a=>a.filter(i=>i.id!==s)),(o==null?void 0:o.id)===s&&m(null))},V=s=>{m(s),w("zones")},H=s=>{R(s.id),w("map")},K=(s,a)=>{const i={lat:a.reduce((n,g)=>n+g[0],0)/a.length,lng:a.reduce((n,g)=>n+g[1],0)/a.length},t=a.map(n=>[n[1],n[0]]);if(t.length>0){const n=t[0],g=t[t.length-1];(n[0]!==g[0]||n[1]!==g[1])&&t.push([...n])}const l=r.map(n=>n.id===s?{...n,polygon:{coordinates:[t],center:i}}:n);f(l);const p=l.map(n=>({id:n.id,name:n.name,description:n.description,cities:n.cities,provinces:n.provinces,postalCodes:n.postalCodes,color:n.color,polygon:n.polygon,timeSlotRestrictions:n.timeSlotRestrictions}));k(p),x(!0),setTimeout(()=>x(!1),2e3)},M=()=>{R(null),window.finishPolygonEditing&&window.finishPolygonEditing()},W=(s,a)=>{if(!o)return;const i={...o};i.timeSlotRestrictions||(i.timeSlotRestrictions={excludedSlots:[],preferredSlots:[]});const t=i.timeSlotRestrictions.excludedSlots||[];a?i.timeSlotRestrictions.excludedSlots=t.filter(l=>l!==s):t.includes(s)||(i.timeSlotRestrictions.excludedSlots=[...t,s]),m(i)},Q=s=>{var a;return(a=o==null?void 0:o.timeSlotRestrictions)!=null&&a.excludedSlots?!o.timeSlotRestrictions.excludedSlots.includes(s):!0},X=()=>{try{const s=k(r),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),i="deliveryZones.json",t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",i),t.click(),x(!0),setTimeout(()=>x(!1),3e3)}catch(s){console.error("Errore durante il salvataggio:",s),alert("Errore durante il salvataggio del file di configurazione")}},F=()=>{j.password===me?P({...j,isAuthenticated:!0}):alert("Password non corretta")};return j.isAuthenticated?e.jsx("div",{className:"min-h-screen bg-gray-50 pb-16 md:pb-0 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestione Zone di Consegna"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configura le zone di consegna utilizzando la mappa interattiva"})]}),e.jsxs(oe,{value:J,onValueChange:w,className:"space-y-6",children:[e.jsxs(le,{className:"grid w-full grid-cols-3",children:[e.jsxs(E,{value:"map",className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Mappa"]}),e.jsx(E,{value:"zones",children:"Zone"}),e.jsx(E,{value:"code",children:"Codice"})]}),e.jsx(A,{value:"map",className:"space-y-6",children:e.jsxs(v,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Mappa Interattiva"}),e.jsx(T,{children:h?"ModalitÃ  modifica attiva: trascina i punti rossi per modificare il poligono":"Utilizza gli strumenti di disegno per creare nuove zone di consegna"})]}),e.jsxs(C,{children:[h&&e.jsxs(O,{className:"mb-4",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs(B,{children:["Stai modificando il poligono della zona ",e.jsx("strong",{children:(I=r.find(s=>s.id===h))==null?void 0:I.name}),". Trascina i punti rossi per modificare la forma.",e.jsx(d,{size:"sm",variant:"outline",className:"ml-2",onClick:M,children:"Termina Modifica"})]})]}),e.jsx(re,{onPolygonCreated:G,onPolygonEdited:K,editingZoneId:h,existingZones:r.filter(s=>s.polygon).map(s=>({id:s.id,name:s.name,coordinates:s.polygon.coordinates,color:s.color})),height:"400px",center:[41.1171,16.8719],zoom:11})]})]})}),e.jsx(A,{value:"zones",className:"space-y-6",children:e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(N,{children:["Zone Configurate (",r.length,")"]})}),e.jsxs(C,{children:[r.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Nessuna zona configurata"}):e.jsx("div",{className:"space-y-4",children:r.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>V(s),title:"Modifica informazioni zona",children:e.jsx(ee,{className:"w-4 h-4"})}),s.polygon&&e.jsx(d,{size:"sm",variant:h===s.id?"default":"outline",onClick:()=>h===s.id?M():H(s),title:h===s.id?"Termina modifica poligono":"Modifica poligono",children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>_(s.id),title:"Elimina zona",children:e.jsx(se,{className:"w-4 h-4"})})]})]})},s.id))}),o&&e.jsxs(v,{className:"mt-6",children:[e.jsx(y,{children:e.jsxs(N,{children:["Modifica Zona: ",o.name]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"zoneName",children:"Nome Zona"}),e.jsx(Z,{id:"zoneName",value:o.name,onChange:s=>m({...o,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"zoneColor",children:"Colore"}),e.jsx(Z,{id:"zoneColor",type:"color",value:o.color,onChange:s=>m({...o,color:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"zoneDescription",children:"Descrizione"}),e.jsx(ne,{id:"zoneDescription",value:o.description,onChange:s=>m({...o,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx(u,{className:"text-base font-semibold",children:"Fasce Orarie Disponibili"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Seleziona le fasce orarie disponibili per questa zona di consegna"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 p-4 bg-gray-50 rounded-lg",children:pe.map(s=>{const a=Q(s);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:`slot-${s}`,checked:a,onCheckedChange:i=>W(s,i)}),e.jsx(u,{htmlFor:`slot-${s}`,className:`text-sm cursor-pointer ${a?"text-gray-900":"text-gray-500 line-through"}`,children:s})]},s)})}),e.jsx("div",{className:"text-xs text-gray-500",children:"ðŸ’¡ Gli slot non selezionati non saranno disponibili per questa zona"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>{f(i=>i.map(t=>t.id===o.id?o:t)),m(null);const a=r.map(i=>i.id===o.id?o:i).map(i=>({id:i.id,name:i.name,description:i.description,cities:i.cities,provinces:i.provinces,postalCodes:i.postalCodes,color:i.color,polygon:i.polygon,timeSlotRestrictions:i.timeSlotRestrictions}));k(a),x(!0),setTimeout(()=>x(!1),3e3)},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Salva Modifiche"]}),e.jsx(d,{variant:"outline",onClick:()=>m(null),children:"Annulla"})]})]})]})]})]})}),e.jsx(A,{value:"code",className:"space-y-6",children:e.jsxs(v,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Codice Generato"}),e.jsx(T,{children:'Codice di configurazione per le zone di consegna. Usa "Salva nel Codice" per generare il file deliveryZones.json da sostituire nella cartella config.'})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[r.some(s=>s.polygon)&&e.jsx(O,{children:e.jsxs(B,{children:[e.jsx("strong",{children:"Istruzioni:"}),' Dopo aver cliccato "Salva nel Codice", sostituisci il file ',e.jsx("code",{children:"src/config/deliveryZones.json"})," con quello scaricato per rendere permanenti le zone create."]})}),e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg",children:e.jsx("pre",{className:"text-sm overflow-auto",children:JSON.stringify(r,null,2)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(JSON.stringify(r,null,2)),D(!0),setTimeout(()=>D(!1),2e3)},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),$?"Copiato!":"Copia"]}),e.jsxs(d,{variant:"outline",onClick:()=>{const s=JSON.stringify(r,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),i="zone-consegna.json",t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",i),t.click()},children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Scarica"]}),e.jsxs(d,{onClick:X,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),q?"Salvato!":"Salva nel Codice"]})]})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 pb-16 md:pb-0 flex items-center justify-center",children:e.jsxs(v,{className:"w-full max-w-md",children:[e.jsxs(y,{children:[e.jsx(N,{children:"Accesso Admin - Gestione Zone"}),e.jsx(T,{children:"Inserisci la password per accedere"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{id:"password",type:S?"text":"password",value:j.password,onChange:s=>P({...j,password:s.target.value}),onKeyPress:s=>s.key==="Enter"&&F(),className:"pr-10"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>U(!S),children:S?e.jsx(Y,{className:"h-4 w-4 text-gray-400"}):e.jsx(z,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsx(d,{onClick:F,className:"w-full",children:"Accedi"})]})]})})};export{Ae as default};
