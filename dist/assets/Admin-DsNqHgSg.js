import{j as e,F as he,ab as pe,a9 as ue,ak as V,K as je,M as G,a8 as ge,ay as fe,t as ve,av as H,az as Ne,aA as be,H as Ce,p as U,x as ye,O as we}from"./ui-vendor-BbdbCsUZ.js";import{r as a}from"./react-vendor-DTdTrAaS.js";import{C as h,b as p,c as u,d as S,a as j}from"./card-po8LLNoY.js";import{B as x}from"./button-DV96QXU2.js";import{I as g}from"./input-BScXBkmv.js";import{L as t}from"./label-CwSIXhkn.js";import{T as W}from"./textarea-DYIflGP3.js";import{S as Se,a as Pe,b as Ie,c as Ae,d as _}from"./select-eU2r9RA0.js";import{T as $,a as K,b as P,c as b}from"./index-CceCJFVk.js";import{B as I}from"./badge-Dt5wVqj5.js";import{C as k,L as ze}from"./LeafletMap-Brnjz1hq.js";import{c as l}from"./configService-BRo5g1g0.js";import{d as ke}from"./index-CU51xw2J.js";import{getAllZones as Ze,saveZonesToFile as Be}from"./deliveryZones-Dl4LSmEF.js";import"./chart-vendor-CC4yw7IZ.js";import"./query-vendor-CYSRxJYb.js";import"./router-vendor-Dt4hhyuR.js";import"./utils-vendor-BbYF_8OW.js";const Te="ImperatoreBev26",es=()=>{var R,O;const[X,Z]=a.useState(!1),[B,T]=a.useState(""),[A,q]=a.useState(!1),[F,D]=a.useState(l.getConfig()),[m,C]=a.useState(l.getPayPalConfig()),[i,f]=a.useState(l.getBACSConfig()),[o,y]=a.useState(l.getCODConfig()),[v,L]=a.useState([]),[c,E]=a.useState(null),[Fe,J]=a.useState(null),[De,Q]=a.useState(!1),[M,Y]=a.useState({lat:45.4642,lng:9.19}),[ee,se]=a.useState(10),[N,w]=a.useState(!1),[ae,n]=a.useState(!1),[ie,ne]=a.useState("payments"),{toast:d}=ke();a.useRef(null),a.useEffect(()=>{const s=l.getConfig();D(s),te()},[]);const te=()=>{try{const s=Ze();L(s)}catch(s){console.error("Errore nel caricamento delle zone:",s),d({title:"Errore",description:"Impossibile caricare le zone di consegna.",variant:"destructive"})}},le=s=>{s.preventDefault(),B===Te?(Z(!0),d({title:"Accesso autorizzato",description:"Benvenuto nell'area amministrativa."})):(d({title:"Password errata",description:"La password inserita non è corretta.",variant:"destructive"}),T(""))},ce=async()=>{w(!0);try{l.updateConfig(F),l.updatePayPalConfig(m),l.updateBACSConfig(i),l.updateCODConfig(o),n(!1),d({title:"Configurazione salvata",description:"Le impostazioni di pagamento sono state aggiornate con successo."})}catch{d({title:"Errore",description:"Impossibile salvare la configurazione.",variant:"destructive"})}finally{w(!1)}},re=()=>{const s=l.getConfig();D(s),C(l.getPayPalConfig()),f(l.getBACSConfig()),y(l.getCODConfig()),n(!1),d({title:"Configurazione ripristinata",description:"Le impostazioni sono state ripristinate ai valori predefiniti."})},oe=async()=>{w(!0);try{await Be(v),d({title:"Zone salvate",description:"Le zone di consegna sono state salvate con successo."})}catch{d({title:"Errore",description:"Impossibile salvare le zone di consegna.",variant:"destructive"})}finally{w(!1)}},de=s=>{var r;E(s),(r=s.polygon)!=null&&r.center&&(Y(s.polygon.center),se(12))},me=()=>{const s={id:`zone_${Date.now()}`,name:"",description:"",cities:[],provinces:[],postalCodes:[],color:"#3B82F6",timeSlotRestrictions:{preferredSlots:[],excludedSlots:[]}};J(s),Q(!0)},xe=s=>{const r=v.filter(z=>z.id!==s);L(r),(c==null?void 0:c.id)===s&&E(null),d({title:"Zona eliminata",description:"La zona di consegna è stata eliminata."})};return X?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pannello Amministrativo"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestisci pagamenti e zone di consegna"})]}),e.jsxs(x,{variant:"outline",onClick:()=>Z(!1),className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Esci"})]})]})}),e.jsxs($,{value:ie,onValueChange:ne,className:"space-y-6",children:[e.jsxs(K,{className:"grid w-full grid-cols-2",children:[e.jsxs(P,{value:"payments",className:"flex items-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Gestione Pagamenti"})]}),e.jsxs(P,{value:"zones",className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Gestione Zone"})]})]}),e.jsx(b,{value:"payments",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{children:"Configurazione Metodi di Pagamento"})]}),e.jsx(S,{children:"Configura e gestisci i metodi di pagamento disponibili nel tuo negozio"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center space-x-2",children:ae&&e.jsxs(I,{variant:"secondary",className:"flex items-center space-x-1",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsx("span",{children:"Modifiche non salvate"})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(x,{variant:"outline",onClick:re,disabled:N,className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Ripristina"})]}),e.jsxs(x,{onClick:ce,disabled:N,className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:N?"Salvataggio...":"Salva Configurazione"})]})]})]}),e.jsxs($,{defaultValue:"bacs",className:"space-y-4",children:[e.jsxs(K,{className:"grid w-full grid-cols-2",children:[e.jsx(P,{value:"bacs",children:"Bonifico"}),e.jsx(P,{value:"cod",children:"Contrassegno"})]}),e.jsx(b,{value:"paypal",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{children:"Configurazione PayPal"}),e.jsx(I,{variant:m.clientId?"default":"secondary",children:m.clientId?"Attivo":"Disattivo"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"paypal-enabled",checked:F.paypal.clientId!=="",onCheckedChange:s=>{s||C({...m,clientId:""}),n(!0)}}),e.jsx(t,{htmlFor:"paypal-enabled",children:"Abilita PayPal"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"paypal-client-id",children:"Client ID"}),e.jsx(g,{id:"paypal-client-id",value:m.clientId,onChange:s=>{C({...m,clientId:s.target.value}),n(!0)},placeholder:"Inserisci PayPal Client ID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"paypal-environment",children:"Ambiente"}),e.jsxs(Se,{value:m.environment,onValueChange:s=>{C({...m,environment:s}),n(!0)},children:[e.jsx(Pe,{children:e.jsx(Ie,{})}),e.jsxs(Ae,{children:[e.jsx(_,{value:"sandbox",children:"Sandbox (Test)"}),e.jsx(_,{value:"production",children:"Production (Live)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"paypal-currency",children:"Valuta"}),e.jsx(g,{id:"paypal-currency",value:"EUR",disabled:!0,placeholder:"EUR"})]})]})]})}),e.jsx(b,{value:"bacs",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Configurazione Bonifico Bancario"}),e.jsx(I,{variant:i.enabled?"default":"secondary",children:i.enabled?"Attivo":"Disattivo"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"bacs-enabled",checked:i.enabled,onCheckedChange:s=>{f({...i,enabled:!!s}),n(!0)}}),e.jsx(t,{htmlFor:"bacs-enabled",children:"Abilita Bonifico Bancario"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"bacs-account-name",children:"Nome Beneficiario"}),e.jsx(g,{id:"bacs-account-name",value:i.accountName,onChange:s=>{f({...i,accountName:s.target.value}),n(!0)},placeholder:"Nome del beneficiario"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"bacs-bank-name",children:"Nome Banca"}),e.jsx(g,{id:"bacs-bank-name",value:i.bankName,onChange:s=>{f({...i,bankName:s.target.value}),n(!0)},placeholder:"Nome della banca"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"bacs-iban",children:"IBAN"}),e.jsx(g,{id:"bacs-iban",value:i.iban,onChange:s=>{f({...i,iban:s.target.value}),n(!0)},placeholder:"IT00 X000 0000 0000 0000 0000 000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"bacs-instructions",children:"Istruzioni"}),e.jsx(W,{id:"bacs-instructions",value:i.instructions,onChange:s=>{f({...i,instructions:s.target.value}),n(!0)},placeholder:"Istruzioni per il bonifico bancario",rows:3})]})]})]})}),e.jsx(b,{value:"cod",className:"space-y-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{children:"Configurazione Contrassegno"}),e.jsx(I,{variant:o.enabled?"default":"secondary",children:o.enabled?"Attivo":"Disattivo"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"cod-enabled",checked:o.enabled,onCheckedChange:s=>{y({...o,enabled:!!s}),n(!0)}}),e.jsx(t,{htmlFor:"cod-enabled",children:"Abilita Contrassegno"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"cod-fee",children:"Commissione (€)"}),e.jsx(g,{id:"cod-fee",type:"number",step:"0.01",value:o.feeAmount,onChange:s=>{y({...o,feeAmount:parseFloat(s.target.value)||0}),n(!0)},placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"cod-instructions",children:"Istruzioni"}),e.jsx(W,{id:"cod-instructions",value:o.instructions,onChange:s=>{y({...o,instructions:s.target.value}),n(!0)},placeholder:"Istruzioni per il pagamento in contrassegno",rows:3})]})]})]})})]})]})]})}),e.jsx(b,{value:"zones",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{children:"Zone di Consegna"})]}),e.jsxs(x,{onClick:me,size:"sm",className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Nuova"})]})]}),e.jsx(S,{children:"Gestisci le zone di consegna disponibili"})]}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[v.map(s=>{var r;return e.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${(c==null?void 0:c.id)===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>de(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((r=s.cities)==null?void 0:r.length)||0," città"]})]})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:z=>{z.stopPropagation(),xe(s.id)},className:"text-red-600 hover:text-red-700",children:e.jsx(we,{className:"w-4 h-4"})})]})},s.id)}),v.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nessuna zona configurata"}),e.jsx("p",{className:"text-sm",children:'Clicca "Nuova" per iniziare'})]})]})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(x,{onClick:oe,disabled:N,className:"w-full flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:N?"Salvataggio...":"Salva Zone"})]})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{children:"Mappa Zone di Consegna"})]}),e.jsx(S,{children:"Visualizza le zone di consegna sulla mappa"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"h-96 rounded-lg overflow-hidden",children:e.jsx(ze,{center:[M.lat,M.lng],zoom:ee,existingZones:v.map(s=>{var r;return{id:s.id,name:s.name,coordinates:((r=s.polygon)==null?void 0:r.coordinates)||[],color:s.color||"#3b82f6"}}),height:"384px"})}),c&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:c.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Città:"}),e.jsx("p",{className:"text-gray-600",children:((R=c.cities)==null?void 0:R.join(", "))||"Nessuna città"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Province:"}),e.jsx("p",{className:"text-gray-600",children:((O=c.provinces)==null?void 0:O.join(", "))||"Nessuna provincia"})]})]})]})]})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(h,{className:"w-full max-w-md",children:[e.jsxs(p,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(he,{className:"w-6 h-6 text-blue-600"})}),e.jsx(u,{className:"text-2xl font-bold",children:"Area Amministrativa"}),e.jsx(S,{children:"Inserisci la password per accedere al pannello di controllo"})]}),e.jsx(j,{children:e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password",type:A?"text":"password",value:B,onChange:s=>T(s.target.value),placeholder:"Inserisci la password",className:"pr-10"}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>q(!A),children:A?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"})})]})]}),e.jsxs(x,{type:"submit",className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Accedi"]})]})})]})})};export{es as default};
